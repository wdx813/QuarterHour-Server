<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>一刻钟·婚礼服务管理后台</title>
	<meta name="renderer" content="webkit">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="format-detection" content="telephone=no">
	<link rel="stylesheet" href="/Public/home/layui/css/layui.css" media="all" />
    <link rel="stylesheet" href="/Public/admin/css/main.css" media="all" />
	<style type="text/css">
		.layui-form-item .layui-inline{ width:33.333%; float:left; margin-right:0; }
		@media(max-width:1240px){
			.layui-form-item .layui-inline{ width:100%; float:none; }
		}
	</style>
</head>
<body class="layui-container">
	<div class="layui-form" style="width: 80%;">
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">兑换码：</label>
                <div class="layui-input-block">
                    <input class="layui-input" value="{$cdkey.cdkey}" disabled>
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">有效期：</label>
                <div class="layui-input-block">
                    <input class="layui-input" value="{$cdkey.expire_time}" disabled>
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">创建时间：</label>
                <div class="layui-input-block">
                    <input class="layui-input" value="{$cdkey.create_time}" disabled>
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">使用账号：</label>
                <div class="layui-input-block">
                    <input class="layui-input" value="{$cdkey.phone}" disabled>
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">公司名称：</label>
                <div class="layui-input-block">
                    <input class="layui-input" value="{$cdkey.c_name}" disabled>
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">使用时间：</label>
                <div class="layui-input-block">
                    <input class="layui-input" value="{$cdkey.use_time}" disabled>
                </div>
            </div>
        </div>
    </div>
	<script type="text/javascript" src="/Public/home/layui/layui.js"></script>
	<script>
		layui.use(['layer', 'element', 'form'], function () {
            let layer = parent.layer === undefined ? layui.layer : parent.layer,
                form = layui.form,
                $ = layui.jquery;

            // 表单验证
            form.verify({
                'expire_time': function (value) {
                    if(value <= 0) {
                        return '有效时间为正整数！'
                    }
                }
            });

            // 表单提交
            form.on('submit(edit_cdkey)', function (data) {
                console.log(data.field);
                let index = top.layer.msg('数据提交中，请稍候',{icon: 16, time: false});
                $.post('/admin/cdkey/update', data.field, function (res) {
                    if(res && res.result_code === 200) {
                        layer.close(index);
                        layer.msg("更新成功！");
                        layer.closeAll("iframe");
                        //刷新父页面
                        parent.location.reload();
                    } else {
                        layer.close(index);
                        layer.msg("更新失败！");
                    }
                });
                return false;
            });
        });
	</script>
</body>
</html>